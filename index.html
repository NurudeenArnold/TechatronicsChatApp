<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Simple Chat App</title>
</head>
<body>
    <div class="usernameForm">
        <form id="usernameForm">
            <label for="username">Enter your username:</label>
            <input type="text" id="usernameInput" autocomplete="off" />
            <button type="submit">Join Chat</button>
        </form>
    </div>

    <div id="chatWindow" style="display: none">
        <ul id="messages"></ul>
        <div class="messageSend">
            <input id="messageInput" autocomplete="off" /><button id="sendButton">Send</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const usernameForm = document.getElementById("usernameForm");
        const chatWindow = document.getElementById("chatWindow");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");
        const messages = document.getElementById("messages");
        let username = "";
        let currentUser = "";

        usernameForm.addEventListener("submit", (event) => {
            event.preventDefault();
            const enteredUsername = document.getElementById("usernameInput").value.trim();
            if (enteredUsername !== "") {
                usernameForm.style.display = "none";
                chatWindow.style.display = "block";
                currentUser = enteredUsername;
                username = enteredUsername;
                socket.emit("user joined", username);
            }
        });

        sendButton.addEventListener("click", () => {
            sendMessage();
        });

        messageInput.addEventListener("keypress", (event) => {
            if (event.keyCode === 13) {
                sendMessage();
            }
        });

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message !== "") {
                socket.emit("chat message", { username, message });
                messageInput.value = "";
            }
        }

        socket.on("connect", () => {
            console.log("Connected to server");
        });

        socket.on("user joined", (receivedUsername) => {
            console.log(`${receivedUsername} joined the chat`);
            const userJoinedMessage = document.createElement("div");
            userJoinedMessage.className = "user-joined-message";
            userJoinedMessage.textContent = `${receivedUsername} joined the chat`;
            messages.appendChild(userJoinedMessage);
        });

        socket.on("chat message", (data) => {
    const { username, message } = data;
    const currentTime = new Date();
    const hours = currentTime.getHours();
    const minutes = currentTime.getMinutes();
    const formattedTime = `${hours}:${minutes < 10 ? '0' : ''}${minutes}`;
    if (username === "System") {
        const systemMessage = document.createElement("div");
        systemMessage.className = "user-joined-message";
        systemMessage.textContent = message;
        messages.appendChild(systemMessage);
    } else {
        const messageWrapper = document.createElement("div");
        messageWrapper.className = "message-wrapper";
        const messageContainer = document.createElement("div");
        messageContainer.className = "message-container";

        const isOwnMessage = username === currentUser;

        if (isOwnMessage) {
            messageContainer.classList.add("own-message");
        }

        const usernameElement = document.createElement("div");
        usernameElement.className = "username";
        usernameElement.textContent = username;

        const messageElement = document.createElement("div");
        messageElement.className = "message";
        messageElement.textContent = message;

        messageContainer.appendChild(usernameElement);
        messageContainer.appendChild(messageElement);

        const timeSentElement = document.createElement("div");
timeSentElement.className = "time-sent";
timeSentElement.textContent = formattedTime;

messageContainer.appendChild(usernameElement);
messageContainer.appendChild(messageElement);
messageContainer.appendChild(timeSentElement); 

messageWrapper.appendChild(messageContainer);

messages.appendChild(messageWrapper);
messages.scrollTop = messages.scrollHeight;
    }
});

    </script>
</body>
</html>
